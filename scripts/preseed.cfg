# Debian Preseed Configuration for Dotfiles Setup

### Localization
# Locale sets language and country
d-i debian-installer/locale string en_US.UTF-8

# Keyboard selection
d-i keyboard-configuration/xkb-keymap select us

### Network configuration
# netcfg will choose an interface that has link if possible
d-i netcfg/choose_interface select auto
# Any hostname and domain names assigned from dhcp take precedence over
# values set here. However, setting the values still prevents the questions
# from being shown, even if values come from dhcp.
d-i netcfg/get_hostname string dotfiles-system
d-i netcfg/get_domain string local

### Mirror settings
d-i mirror/country string manual
d-i mirror/http/hostname string deb.debian.org
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string

### Account setup
# Skip creation of a root account (normal user account will be able to
# use sudo)
d-i passwd/root-login boolean false
# Create a normal user account
d-i passwd/user-fullname string Dotfiles User
d-i passwd/username string user
# Normal user's password, either in clear text
d-i passwd/user-password password password
d-i passwd/user-password-again password password
# Create the first user with the specified UID instead of the default
d-i passwd/user-uid string 1000

### Clock and time zone setup
d-i clock-setup/utc boolean true
d-i time/zone string UTC
d-i clock-setup/ntp boolean true

### Partitioning
d-i partman-auto/method string regular
d-i partman-auto/choose_recipe select atomic
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

### Package selection
tasksel tasksel/first multiselect standard, ssh-server
# Individual additional packages to install
d-i pkgsel/include string sudo git curl wget build-essential

# Whether to upgrade packages after debootstrap
d-i pkgsel/upgrade select full-upgrade

### Boot loader installation
d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean true
d-i grub-installer/bootdev string default

### Finishing up the installation
d-i finish-install/reboot_in_progress note

### Post-installation commands
# This command is run just before the install finishes
d-i preseed/late_command string \
  in-target mkdir -p /home/user/.config; \
  in-target git clone https://github.com/Juicyyyyyyy/dotfiles /home/user/.config; \
  in-target chown -R user:user /home/user/.config; \
  in-target chmod +x /home/user/.config/setup.sh; \
  in-target chmod +x /home/user/.config/scripts/*.sh; \
  in-target chmod +x /home/user/.config/rofi/setup.sh; \
  in-target echo "cd ~/.config && ./setup.sh && cd ~/.config/rofi && ./setup.sh" > /home/user/setup-dotfiles.sh; \
  in-target chmod +x /home/user/setup-dotfiles.sh; \
  in-target chown user:user /home/user/setup-dotfiles.sh; \
  in-target echo "#!/bin/bash\nsu - user -c '/home/user/setup-dotfiles.sh'" > /etc/rc.local; \
  in-target chmod +x /etc/rc.local;